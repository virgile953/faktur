import{r as x,j as e}from"./index-CKBIMJ8Q.js";import{g as w,L as b,u as N,c as y,O as F}from"./components-DqBg-pzF.js";import{F as j}from"./FilterSelect-B3842IOY.js";import{l as P,S,F as D,R as E}from"./ChevronDownIcon-BVtRQATA.js";import"./use-resolve-button-type-B2Wslbw_.js";function T({title:t,titleId:a,...c},m){return x.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:m,"aria-labelledby":a},c),t?x.createElement("title",{id:a},t):null,x.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 1 0 0-16 8 8 0 0 0 0 16Zm.75-11.25a.75.75 0 0 0-1.5 0v2.5h-2.5a.75.75 0 0 0 0 1.5h2.5v2.5a.75.75 0 0 0 1.5 0v-2.5h2.5a.75.75 0 0 0 0-1.5h-2.5v-2.5Z",clipRule:"evenodd"}))}const C=x.forwardRef(T);function k({Item:t,Filaments:a,Printer:c,consos:m,elecPrice:u}){var f;function h(r){return r<60?r.toString():`0${r/60^0}`.slice(-2)+":"+("0"+r%60).slice(-2)}function i(){const r=t.timeToPrint/60,n=m.reduce((d,p)=>d+p.consoKw,0);return u*r*(n/1e3)}function l(){let r=0;return a.map((n,g)=>{const d=n.price/1e3*t.filamentsQuantity[g];r+=d}),r}function s(){let r=0;return a.map((n,g)=>{const d=n.price/1e3*t.filamentsQuantity[g];r+=d}),r}const o=w();return o.state==="idle"&&o.data&&o.data.success&&((f=o.formData)==null?void 0:f.get("_action"))==="delete"&&window.dispatchEvent(new CustomEvent("print-deleted",{detail:{id:t.id}})),e.jsxs("div",{className:"group border relative border-gray-700 rounded-lg min-h-72 h-full grow",children:[e.jsxs("div",{className:"absolute bottom-2 right-2 flex gap-2 z-10 opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:[e.jsx(b,{to:`/prints/${t.id}/edit`,className:"text-s px-3 py-1 rounded-lg bg-gray-800 hover:bg-gray-700 border border-gray-600",children:"Edit"}),e.jsxs(o.Form,{method:"post",children:[e.jsx("input",{type:"hidden",name:"_action",value:"delete"}),e.jsx("input",{type:"hidden",name:"printId",value:t.id}),e.jsx("button",{type:"submit",disabled:o.state!=="idle",className:"text-s px-3 py-1 rounded-lg bg-red-900 hover:bg-red-800 border border-red-700 disabled:opacity-50",children:o.state==="submitting"?"...":"Archive"})]})]}),e.jsxs("div",{className:"flex flex-row justify-between border-b border-gray-700",children:[t.image!=""?e.jsx("div",{className:"h-32 w-32 min-h-32 min-w-32 overflow-hidden",children:e.jsx("img",{className:"h-full w-full object-cover rounded-tl-lg",src:`${t.image.replace("/","")}`})}):e.jsx("div",{className:"h-32 w-32 min-h-32 min-w-32 rounded-tl-lg bg-[repeating-linear-gradient(to_bottom_right,#374151_0px,#374151_20px,#1f2937_20px,#1f2937_40px)]"}),e.jsxs("div",{className:"flex flex-col text-end items-end w-fit p-2 justify-between",children:[e.jsx("div",{className:"px-2 text-3xl font-semibold",children:t.name}),e.jsx("div",{className:"px-1 text-lg",children:new Date(t.date).toLocaleDateString("fr-FR")})]})]}),e.jsxs("div",{className:"flex flex-row gap-2 w-fit m-2 p-2 ",children:[e.jsx("img",{src:"/printer.svg",className:"h-8 invert"}),c&&e.jsx("div",{children:c.name})]}),e.jsxs("div",{className:"flex flex-row gap-2 border-t border-b border-gray-800 p-2 my-2",children:[e.jsx("img",{src:"/filament.svg",className:"h-8 ml-2 invert"}),e.jsx("div",{className:"flex flex-col",children:a.length>0&&a.map((r,n)=>e.jsxs("div",{children:[t.filamentsQuantity[n]," ",r.unit," ",r.name," (",r.material,")"]},r.id))})]}),e.jsx("div",{className:"w-fit m-2 p-2",children:e.jsxs("div",{className:"flex flex-row gap-2 items-center",children:[e.jsx("img",{src:"/clock.svg",className:"h-6 ml-1 invert"}),e.jsxs("div",{children:[t.timeToPrint,"mins ",t.timeToPrint>59&&`(${h(t.timeToPrint)}h)`]})]})}),e.jsxs("div",{className:" border-t m-2 p-2",children:[m.length==0&&e.jsx("div",{children:"no conso info for this printer and materials"}),m.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[i().toFixed(2)," € elec"]}),e.jsxs("div",{children:[l().toFixed(2)," € filament"]}),e.jsxs("div",{children:[s().toFixed(2)," € work"]}),e.jsxs("div",{children:[(l()+i()+s()).toFixed(2)," € total"]})]})]})]})}function R({rows:t,selectedRow:a,setSelectedSort:c,initialPrints:m,setFilteredPrints:u}){function h(i){c(i);let l=[...m];i===0?l.sort((s,o)=>new Date(s.date).getTime()-new Date(o.date).getTime()):i===1?l.sort((s,o)=>s.name.localeCompare(o.name)):i===2&&l.sort((s,o)=>s.timeToPrint-o.timeToPrint),u(l)}return e.jsxs(P,{className:"group min-w-52",children:[e.jsxs(S,{className:`flex flex-row w-full border
					group-data-[open]:border-b-transparent group-data-[open]:rounded-b-none
					border-gray-700 rounded-lg items-center justify-between gap-1`,children:[a===-1?e.jsx("div",{className:"p-2",children:"Sort by"}):e.jsx("div",{className:"p-2",children:t[a]}),e.jsx(D,{className:`align-bottom size-5 group-data-[open]:-rotate-180
						transition duration-100`})]}),e.jsx(E,{"aria-orientation":"vertical",transition:!0,anchor:"bottom",className:`divide-y divide-white/5 rounded-b-lg bg-black/95
					text-sm/6 ease-in-out 
					[data-[closed]:-translate-y-1 data-[closed]:opacity-0
					border border-gray-700 w-52`,children:({close:i})=>e.jsxs(e.Fragment,{children:[a>-1&&e.jsx("div",{className:"rounded-lg py-2 px-5 hover:bg-white/5 w-full block font-medium",onClick:()=>{c(-1),u(m),i()},children:e.jsx("div",{className:"mt-2",children:"Default"})},"remove-filter"),t.map((l,s)=>e.jsx("div",{className:"rounded-lg py-2 px-5 hover:bg-white/5 w-full block font-medium",onClick:()=>{h(s),i()},children:e.jsx("div",{className:"flex flex-row gap-4",children:e.jsx("div",{className:"mt-2",children:l})})},s))]})})]})}function L({initialPrints:t,setFilteredPrints:a,printers:c,filaments:m}){const[u,h]=x.useState(null),[i,l]=x.useState(null),[s,o]=x.useState(-1),[f,r]=x.useState(0),n=["Date","Name","Print time"];function g(){let d=[...t];u&&(d=d.filter(p=>p.printerUsed===u.id)),i&&(d=d.filter(p=>p.filamentsUsed.includes(i.id))),s===0?d.sort((p,v)=>new Date(p.date).getTime()-new Date(v.date).getTime()):s===1?d.sort((p,v)=>p.name.localeCompare(v.name)):s===2&&d.sort((p,v)=>p.timeToPrint-v.timeToPrint),f&&d.reverse(),a(d)}return x.useEffect(()=>{g()},[u,i,s,f]),e.jsxs("div",{className:"p-4 rounded-lg flex flex-row basis-64 flex-wrap gap-4",children:[e.jsx(j,{items:c,selectedItem:u,setSelectedItem:h,label:"Printer"}),e.jsx(j,{items:m,selectedItem:i,setSelectedItem:l,label:"Filament"}),e.jsx(R,{rows:n,selectedRow:s,setSelectedSort:o,initialPrints:t,setFilteredPrints:a}),f==0?e.jsx("img",{className:"border border-gray-700 rounded-lg w-10 h-10 invert hover:invert-0 cursor-pointer hover:bg-white",src:"/sortUp.svg",alt:"SortUp",onClick:()=>{r(1)}}):e.jsx("img",{className:"border border-gray-700 rounded-lg w-10 h-10 invert hover:invert-0 cursor-pointer hover:bg-white",src:"/sortDown.svg",alt:"SortUp",onClick:()=>{r(0)}})]})}function U({initialPrints:t,Filaments:a,Printers:c,consos:m,elecPrice:u}){const[h,i]=x.useState(t);return x.useEffect(()=>{i(t)},[t]),x.useEffect(()=>{function l(s){const o=s.detail.id;i(f=>f.filter(r=>r.id!==o))}return window.addEventListener("print-deleted",l),()=>window.removeEventListener("print-deleted",l)},[]),e.jsx(e.Fragment,{children:e.jsxs("div",{className:"mt-[130px] h-[calc(100vh-130px)] max-w-7xl mx-auto px-4",children:[e.jsx(L,{initialPrints:t,setFilteredPrints:i,printers:c,filaments:a}),e.jsx("div",{className:"p-4 rounded-t-lg flex flex-row flex-wrap gap-2",children:h.map((l,s)=>{const o=m.filter(n=>n.printerId===l.printerUsed),f=a.filter(n=>(n==null?void 0:n.id)!==void 0&&l.filamentsUsed.includes(n.id)),r=o.filter(n=>f.some(g=>g.material===n.filamentType));return e.jsx("div",{className:"basis-64 grow",children:e.jsx(k,{Item:l,Filaments:f,Printer:c.filter(n=>n.id===l.printerUsed)[0],consos:r,elecPrice:u})},s)})}),e.jsxs("div",{className:"border border-gray-700 rounded-lg px-4 py-2 mx-4 -my-4 w-fit",children:[h.length," items"]}),e.jsx(b,{className:"block my-16 mr-10 ml-auto w-fit rounded-full",to:"new",children:e.jsx(C,{height:72,color:"#4a92ff"})})]})})}const A=()=>[{title:"Prints"},{name:"Prints",content:"List of done prints"}];function Z(){const{prints:t,printers:a,filaments:c,consos:m,elecPrice:u}=N();return y().pathname.toLowerCase()!=="/prints"?e.jsx(F,{}):e.jsx(e.Fragment,{children:e.jsx(U,{initialPrints:t,Printers:a,Filaments:c,consos:m,elecPrice:u})})}export{Z as default,A as meta};
